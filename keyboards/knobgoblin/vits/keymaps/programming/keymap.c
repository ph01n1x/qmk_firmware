/* Copyright 2020 MrT1ddl3s
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include QMK_KEYBOARD_H

enum custom_keycodes 
{
    KC_ENC1 = SAFE_RANGE,  // Press encoder 1
    KC_ENC2,               // Press encoder 2
    KC_ENCT,               // Toggle encoder mode
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

    [0] = LAYOUT_ortho
    (
             C(KC_F4), KC_F9,   KC_F5,   KC_F10,
             KC_F3,    KC_F2,   KC_F8,   KC_F11,
             KC_CALC,  KC_ESC,  KC_PGUP, KC_HOME,
    KC_ENC1, KC_PSCR,  KC_UP,   KC_PGDN,  KC_END,
    KC_ENC2, KC_LEFT,  KC_DOWN, KC_RGHT,  MO(1)
    ),

	[1] = LAYOUT_ortho
    (
              A(KC_F4), KC_TRNS,   C(S(KC_F5)), KC_TRNS,
              KC_TRNS,  KC_TRNS,   C(KC_BRK),   S(KC_F11),
              KC_WFWD,  KC_F12,    C(KC_PGUP),  C(KC_HOME),
    KC_ENCT,  KC_WBAK,  KC_TRNS,   C(KC_PGDN),  C(KC_END),
    TG(2),    KC_TRNS,  KC_TRNS,   KC_TRNS,     KC_TRNS
    ),
    
	[2] = LAYOUT_ortho
    (
             KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS,
             KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS,
             KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS,
    KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS,
    KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS
    ),

	[3] = LAYOUT_ortho
    (
             KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS,
             KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS,
             KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS,
    KC_TRNS, KC_TRNS, KC_WH_U, KC_TRNS, KC_TRNS,
    KC_TRNS, KC_BTN1, KC_WH_D, KC_BTN2, KC_TRNS
    )
};

#define LAYER_DEFAULT 0
#define LAYER_SUPER 1
#define LAYER_MOUSE 2

#define ENCODER_MEDIA 0
#define ENCODER_CODE 1

#define ANIMATION_SLEEP 0
#define ANIMATION_NORMAL 1
#define ANIMATION_MATI 2
#define ANIMATION_AWAKE 3
#define ANIMATION_KAKI 4
#define ANIMATION_LEFT 5
#define ANIMATION_RIGHT 6
#define ANIMATION_UP 7
#define ANIMATION_DOWN 8
#define ANIMATION_LTOGIL 9
#define ANIMATION_RTOGIL 10

uint8_t encoder_mode = 0;
uint32_t keyevent_timer = 0;

uint8_t target_animation = 0;

#ifdef ENCODER_ENABLE

// Handle the encoder rotation
bool encoder_update_user(uint8_t index, bool clockwise) 
{
    keyevent_timer = timer_read32();

    // Encoder in code mode
    if (encoder_mode == ENCODER_CODE)
    {
        // Top encoder
        if (index == 0) 
        { 
            if (clockwise) 
            {
                tap_code16(C(KC_B));
                tap_code16(C(KC_N));
                target_animation = ANIMATION_DOWN;
            } 
            else 
            {
                tap_code16(C(KC_B));
                tap_code16(C(KC_P));
                target_animation = ANIMATION_UP;
            }
        }
        
        // Bottom encoder
        if (index == 1) 
        {
            if (clockwise) 
            {
            } 
            else 
            {
            }
        }        
    }
    // Encoder in media mode
    else
    {
        // Top encoder
        if (index == 0) 
        { 
            if (clockwise) 
            {
                tap_code(KC_MNXT);
                target_animation = ANIMATION_RIGHT;
            } 
            else 
            {
                tap_code(KC_MPRV);
                target_animation = ANIMATION_LEFT;
            }
        }

        // Bottom encoder
        if (index == 1) 
        {
            if (clockwise) 
            {
                tap_code(KC_VOLU);
                target_animation = ANIMATION_UP;
            } 
            else 
            {
                tap_code(KC_VOLD);
                target_animation = ANIMATION_DOWN;
            }
        }
    }
    
    // Disable keyboard level code.
    return false;
}
#endif

// Handle key events
bool process_record_user(uint16_t keycode, keyrecord_t *record) 
{
    keyevent_timer = timer_read32();

    if (record->event.pressed)
    {
        switch (keycode) 
        {
            case MO(1):
                target_animation = ANIMATION_AWAKE;
                return true;
                
            case C(KC_F4):
            case A(KC_F4):
                target_animation = ANIMATION_KAKI;
                return true;
                
            case KC_LEFT:
            case KC_HOME:
                target_animation = ANIMATION_LEFT;
                return true; 

            case KC_RIGHT:
            case KC_END:
                target_animation = ANIMATION_RIGHT;
                return true; 

            case KC_UP:
            case KC_PGUP:
            case C(KC_HOME):
                target_animation = ANIMATION_UP;
                return true;
                
            case KC_DOWN:
            case KC_PGDOWN:
            case C(KC_END):
                target_animation = ANIMATION_DOWN;
                return true;
                
            case KC_F3:
                target_animation = ANIMATION_LTOGIL;
                return true;
                
            case KC_F2:
                target_animation = ANIMATION_RTOGIL;
                return true;
                
            case KC_F9:
                target_animation = ANIMATION_KAKI;
                return true;

            case KC_F5:
            case C(S(KC_F5)):
                target_animation = ANIMATION_RIGHT;
                return true;
                
            case KC_F10:
            case KC_F11:
                target_animation = ANIMATION_RTOGIL;
                return true;
                
            case S(KC_F11):
                target_animation = ANIMATION_LTOGIL;
                return true;
                
            case KC_CALC:
                target_animation = ANIMATION_MATI;
                return true;
                
            case KC_PSCR:
                target_animation = ANIMATION_AWAKE;
                return true;

            case KC_MPLY:
                target_animation = ANIMATION_RTOGIL;
                return true;

            case KC_MNXT:
                target_animation = ANIMATION_RIGHT;
                return true;

            case KC_MPRV:
                target_animation = ANIMATION_LEFT;
                return true;

            case KC_MUTE:
                target_animation = ANIMATION_MATI;
                return true;
                
            case KC_VOLU:
                target_animation = ANIMATION_UP;
                return true;
                
            case KC_VOLD:
                target_animation = ANIMATION_DOWN;
                return true;
                
            case KC_WBAK:
                target_animation = ANIMATION_LEFT;
                return true;
            
            case KC_WFWD:
                target_animation = ANIMATION_RIGHT;
                return true;
            
            case KC_BTN1:
                target_animation = ANIMATION_LTOGIL;
                return true;
            
            case KC_BTN2:
                target_animation = ANIMATION_RTOGIL;
                return true;

            case KC_WH_U:
                target_animation = ANIMATION_UP;
                return true;

            case KC_WH_D:
                target_animation = ANIMATION_DOWN;
                return true;
            
            case KC_ENC1:
                if (encoder_mode == ENCODER_CODE)
                {
                    SEND_STRING(SS_LCTL("bt"));
                    target_animation = ANIMATION_AWAKE;
                }
                else
                {
                    tap_code(KC_MPLY);
                    target_animation = ANIMATION_RTOGIL;
                }
                return true;
                
            case KC_ENC2:
                if (encoder_mode == ENCODER_CODE)
                {
                }
                else
                {
                    tap_code(KC_MUTE);
                    target_animation = ANIMATION_MATI;
                }
                return true;

            case KC_ENCT:
                if (encoder_mode == ENCODER_MEDIA)
                {
                    encoder_mode = ENCODER_CODE;
                }
                else
                {
                    encoder_mode = ENCODER_MEDIA;
                }
                target_animation = ANIMATION_AWAKE;
                break;
                
            default:
                target_animation = rand() % 9 + 2;
                return true; 
        }
    }
    
    return true;
}
      
#ifdef OLED_ENABLE

// Rotate screen for proper orentation
__attribute__((weak)) oled_rotation_t oled_init_user(oled_rotation_t rotation) { return OLED_ROTATION_270; }

// Render the top logo
static void render_logo(void) 
{
    static const char PROGMEM my_logo[] = 
    {
    // 'Phoenix', 32x32px
    0x00, 0x00, 0x00, 0x00, 0x80, 0xf0, 0xf8, 0x3c, 0x0c, 0x0e, 0x02, 0x32, 0xc2, 0xc4, 0xe0, 0xe0, 
    0xa0, 0xe0, 0xe4, 0xc2, 0x82, 0x02, 0x06, 0x0c, 0x3c, 0xf8, 0xf0, 0x80, 0x00, 0x00, 0x00, 0x00, 
    0x70, 0xfc, 0xe0, 0xc0, 0x9f, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 
    0xff, 0x01, 0x00, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x9f, 0xc0, 0xe0, 0xfc, 0x70, 
    0x00, 0x11, 0x63, 0xe7, 0xcf, 0xdf, 0xff, 0xf8, 0xf8, 0xf0, 0xf0, 0xf0, 0xf8, 0xfc, 0xfe, 0xff, 
    0xff, 0xfe, 0xfc, 0xf8, 0xf0, 0xf0, 0xf0, 0xf8, 0xfc, 0xff, 0xdf, 0xcf, 0xe7, 0x63, 0x11, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x09, 0x09, 0x19, 0x19, 0x39, 0x3d, 0x7f, 0x7f, 0x7f, 0x7f, 
    0x7f, 0x7f, 0x7f, 0x7f, 0x3d, 0x39, 0x19, 0x19, 0x09, 0x09, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00
    };
    oled_write_raw_P(my_logo, sizeof(my_logo));
}

#define FRAME_SIZE 128
#define FRAMES 2

uint32_t animation_timer = 0;
uint32_t frame_duration = 400;
uint8_t current_animation = 0;
uint8_t current_frame = 0;

static void render_animation(void) 
{
    static const char PROGMEM sleep[FRAMES][FRAME_SIZE] = 
    {
        {
        // 'sleep1', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0xa8, 0x48, 0xa8, 0x18, 0x08, 0x00, 0x00, 0x00, 
        0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x03, 0x02, 0x02, 0x02, 0x02, 0x02, 0x00, 0x00, 0x80, 
        0x44, 0x84, 0x06, 0x05, 0x04, 0x80, 0x40, 0x20, 0x10, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0x18, 0x04, 0x04, 0x02, 0x7a, 0x86, 0x01, 0x80, 
        0x80, 0x01, 0x03, 0x05, 0x07, 0x01, 0x00, 0x00, 0x80, 0x83, 0x45, 0xfa, 0x3c, 0xe0, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x08, 0x10, 0x10, 0x10, 0x10, 0x10, 0x31, 0x22, 0x24, 
        0x28, 0x29, 0x29, 0x29, 0x3a, 0x18, 0x1c, 0x39, 0x24, 0x24, 0x3a, 0x2d, 0x26, 0x31, 0x1f, 0x00
        },
        {
        // 'sleep2', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x3a, 0x2a, 0x26, 0x22, 0x80, 0xc0, 
        0x80, 0x00, 0x24, 0x34, 0x2c, 0xe4, 0x60, 0x10, 0x70, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x38, 0x04, 0x02, 0x02, 0x01, 0x79, 0x87, 0x01, 0x80, 
        0x81, 0x83, 0x05, 0x05, 0x03, 0x01, 0x00, 0x00, 0x80, 0x43, 0x05, 0xfa, 0x3c, 0xe0, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x08, 0x10, 0x10, 0x10, 0x10, 0x10, 0x31, 0x22, 0x24, 
        0x28, 0x28, 0x29, 0x29, 0x3a, 0x18, 0x1c, 0x39, 0x24, 0x24, 0x3a, 0x2d, 0x26, 0x31, 0x1f, 0x00
        }        
    };
    
    static const char PROGMEM kaki[FRAMES][FRAME_SIZE] = 
    {
        {
        // 'kaki1', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x10, 0x20, 0x20, 0x40, 0x40, 0x80, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x06, 0x1a, 0x22, 0xc2, 0x04, 0x04, 0x04, 0x07, 0x00, 0xc0, 0x20, 0x10, 0x80, 0x80, 
        0x01, 0x01, 0x02, 0xfc, 0xfe, 0x02, 0x3c, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x0d, 0x8d, 0x55, 0x50, 0x94, 0xf0, 0x10, 0x09, 0x08, 0x00, 
        0x80, 0x00, 0x06, 0x09, 0x1b, 0xee, 0x00, 0x00, 0x00, 0x00, 0x81, 0xfe, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x1f, 0x14, 0x14, 0x10, 0x10, 0x11, 0x1f, 0x10, 0x10, 0x18, 
        0x0f, 0x18, 0x10, 0x10, 0x1f, 0x19, 0x18, 0x1c, 0x14, 0x16, 0x15, 0x14, 0x14, 0x14, 0x14, 0x08, 
        },
        {
        // 'kaki2', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x10, 0x20, 0x40, 
        0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x01, 0x02, 0x04, 0x04, 0x03, 0x80, 0x40, 0x40, 0x20, 
        0x00, 0x01, 0x02, 0x8c, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x0d, 0x8d, 0x55, 0x50, 0x94, 0xf0, 0x10, 0x0a, 0x0e, 0x1d, 
        0x95, 0x24, 0x24, 0x27, 0x13, 0xe1, 0x01, 0x01, 0x01, 0x01, 0x02, 0xfc, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x1f, 0x14, 0x14, 0x10, 0x10, 0x11, 0x1f, 0x10, 0x10, 0x18, 
        0x0f, 0x18, 0x10, 0x10, 0x1f, 0x19, 0x18, 0x1c, 0x14, 0x14, 0x17, 0x14, 0x14, 0x14, 0x14, 0x08
        }
    };
    
    static const char PROGMEM right[FRAMES][FRAME_SIZE] = 
    {
        {
        // 'right1', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0x20, 0x10, 0x10, 0x08, 0x08, 0x08, 0x10, 
        0x10, 0x20, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x80, 0x60, 0x10, 0x88, 0x44, 0x22, 0x99, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 
        0x30, 0xc0, 0x00, 0x00, 0x00, 0x13, 0x0c, 0x08, 0x08, 0x04, 0x04, 0x82, 0x39, 0x47, 0x80, 0x00, 
        0x03, 0x02, 0x01, 0x00, 0x00, 0x01, 0xc2, 0x3c, 0xb0, 0xc0, 0x00, 0x30, 0xd0, 0x50, 0x58, 0x28, 
        0x16, 0x09, 0x80, 0x80, 0x44, 0xc2, 0x62, 0x26, 0x44, 0x44, 0x40, 0x43, 0x40, 0x20, 0x17, 0x0c, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x03, 0x06, 0x07, 0x01, 0x01, 0x01, 
        0x07, 0x05, 0x04, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        {
        // 'right2', 32x32px
        0x38, 0x48, 0x88, 0x30, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x20, 0x10, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0xf1, 0x0e, 0x00, 0x00, 0x01, 0x02, 0x02, 0x04, 0x04, 0x04, 0x08, 0x08, 0x10, 
        0x20, 0x30, 0x0c, 0x06, 0x01, 0x01, 0x40, 0x40, 0x40, 0x40, 0x1d, 0x01, 0x02, 0x1c, 0xe0, 0x00, 
        0xf8, 0x88, 0xc6, 0x61, 0xa0, 0x60, 0x60, 0x50, 0x50, 0x30, 0x28, 0x68, 0x44, 0x40, 0x40, 0x40, 
        0x40, 0x40, 0xc0, 0xe0, 0xa0, 0x40, 0x80, 0x8c, 0x1c, 0x32, 0x22, 0x42, 0x82, 0x01, 0x00, 0x00, 
        0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x02, 0x01, 0x01, 0x02, 0x02, 0x02, 0x01, 0x00, 0x00
        }        
    };

    static const char PROGMEM left[FRAMES][FRAME_SIZE] = 
    {
        {
        // 'left1', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x20, 0x20, 0x10, 
        0x10, 0x08, 0x08, 0x08, 0x10, 0x10, 0x20, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x80, 0x47, 0x39, 0x82, 0x04, 0x04, 0x08, 0x08, 0x0c, 0x13, 0x00, 0x00, 0x00, 0xc0, 0x30, 
        0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x99, 0x22, 0x44, 0x88, 0x10, 0x60, 0x80, 
        0x0c, 0x17, 0x20, 0x40, 0x43, 0x40, 0x44, 0x44, 0x26, 0x62, 0xc2, 0x40, 0x80, 0x80, 0x09, 0x16, 
        0x28, 0x58, 0x50, 0xd0, 0x30, 0x00, 0xc0, 0xb0, 0x3c, 0xc2, 0x01, 0x00, 0x00, 0x01, 0x02, 0x03, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x04, 0x05, 0x07, 
        0x01, 0x01, 0x01, 0x07, 0x06, 0x03, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        },
        {
        // 'left2', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x10, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x20, 0x10, 0x88, 0x48, 0x38, 
        0x00, 0xe0, 0x1c, 0x02, 0x01, 0x1d, 0x40, 0x40, 0x40, 0x40, 0x01, 0x01, 0x06, 0x0c, 0x30, 0x20, 
        0x10, 0x08, 0x08, 0x04, 0x04, 0x04, 0x02, 0x02, 0x01, 0x00, 0x00, 0x0e, 0xf1, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x01, 0x82, 0x42, 0x22, 0x32, 0x1c, 0x84, 0x84, 0x44, 0xa0, 0xe0, 0xc0, 0x40, 0x40, 
        0x40, 0x40, 0x40, 0x24, 0x28, 0x28, 0x30, 0x50, 0x50, 0x60, 0x60, 0xa0, 0x21, 0x46, 0x88, 0xf8, 
        0x00, 0x00, 0x01, 0x02, 0x02, 0x02, 0x01, 0x01, 0x02, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00
        }
    };
    
    static const char PROGMEM up[FRAMES][FRAME_SIZE] = 
    {
        {
        // 'up1', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xba, 0x8a, 0x86, 0x82, 0x3a, 0x01, 0x01, 
        0x01, 0x01, 0x3a, 0x82, 0x86, 0x8a, 0xba, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x30, 0x11, 0xde, 0x3c, 0x14, 0x14, 0x12, 0x00, 0x00, 
        0x00, 0x02, 0x14, 0x14, 0x14, 0x3c, 0xde, 0x11, 0x30, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x3c, 0x41, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x41, 0x3c, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x1f, 0x20, 
        0x20, 0x1f, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        },
        {
        // 'up2', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x02, 0xc6, 0xbe, 0x8a, 0x86, 0x82, 0x3a, 0x01, 0x01, 
        0x01, 0x01, 0x3a, 0x82, 0x86, 0x8a, 0xbe, 0xc6, 0x02, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x3c, 0xc1, 0x06, 0x8c, 0x94, 0x14, 0x12, 0x00, 0x00, 
        0x00, 0x02, 0x14, 0x14, 0x94, 0x8c, 0x06, 0xc1, 0x3c, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x7e, 0x01, 
        0x01, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x1e, 0x20, 0x20, 0x10, 0x08, 0x04, 0x03, 0x01, 
        0x01, 0x03, 0x04, 0x08, 0x10, 0x20, 0x20, 0x1e, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        }
    };
    
    static const char PROGMEM down[FRAMES][FRAME_SIZE] = 
    {
        {
        // 'down1', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x40, 0x40, 0x7e, 0x01, 
        0x01, 0x7e, 0x40, 0x40, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x1c, 0x02, 0x01, 0xc0, 0x30, 0x08, 0x10, 0x60, 0x80, 
        0x00, 0x80, 0x60, 0x10, 0x08, 0x30, 0xc1, 0x02, 0x04, 0x18, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x74, 0x4f, 0xe8, 0x30, 0x7f, 0x80, 0x00, 0x00, 0x70, 0x00, 0x01, 
        0x81, 0x01, 0x00, 0x70, 0x00, 0x00, 0x80, 0x7f, 0x30, 0xe8, 0x4f, 0x74, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x02, 0x02, 0x06, 0x04, 
        0x04, 0x04, 0x06, 0x02, 0x02, 0x03, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        },
        {
        // 'down2', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x0e, 0x01, 0x03, 0x0e, 0x30, 0x3e, 0x01, 
        0x01, 0x3e, 0x20, 0x10, 0x0e, 0x03, 0x01, 0x0e, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf3, 0x0c, 0xc0, 0x30, 0x08, 0x10, 0x60, 0x80, 
        0x00, 0x80, 0x60, 0x10, 0x08, 0x30, 0xc0, 0x0c, 0xf3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x04, 0x08, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x70, 0x00, 0x01, 
        0x81, 0x01, 0x00, 0x70, 0x00, 0x00, 0x80, 0xff, 0x3f, 0x08, 0x04, 0x04, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x38, 0x41, 0x62, 0x3a, 0x06, 0x04, 
        0x04, 0x04, 0x06, 0x3a, 0x62, 0x41, 0x38, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00    
        }
    };
            
    static const char PROGMEM ltogil[FRAMES][FRAME_SIZE] = 
    {
        {
        // 'ltogi1', 32x32px
        0xf8, 0xf8, 0xf0, 0x20, 0x10, 0x90, 0x0f, 0x01, 0x02, 0x04, 0x08, 0x10, 0x10, 0x20, 0xc0, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x3f, 0x10, 0x23, 0x62, 0xc4, 0xc7, 0x88, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x47, 0x48, 
        0x08, 0x08, 0x08, 0x08, 0x10, 0x10, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x04, 0x0c, 0x88, 0xb8, 0xde, 0xa1, 0xc0, 0x80, 0x80, 
        0xc0, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x43, 0xcc, 0x88, 0x10, 0x20, 0x40, 0x80, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x04, 0x07, 0x07, 0x04, 0x04, 0x04, 0x05, 
        0x04, 0x04, 0x04, 0x04, 0x06, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 
        },
        {
        // 'ltogi2', 32x32px
        0xf0, 0x00, 0x80, 0x40, 0x20, 0xa0, 0x1f, 0x01, 0x02, 0x04, 0x08, 0x10, 0x10, 0x20, 0xc0, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0xff, 0x86, 0x99, 0xa0, 0x40, 0x6b, 0x28, 0x24, 0x24, 0x00, 0x00, 0x00, 0x00, 0x88, 0x47, 0x48, 
        0x08, 0x08, 0x08, 0x08, 0x10, 0x10, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x01, 0x06, 0x0a, 0x0a, 0x06, 0x06, 0x06, 0x04, 0x0c, 0x88, 0x98, 0xbe, 0xe1, 0xc0, 0x80, 0x80, 
        0xc0, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x43, 0x4c, 0x48, 0x44, 0x22, 0x11, 0x0f, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x04, 0x07, 0x07, 0x04, 0x04, 0x04, 0x05, 
        0x04, 0x04, 0x04, 0x04, 0x06, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        }
    };

    static const char PROGMEM rtogil[FRAMES][FRAME_SIZE] = 
    {
        {
        // 'rtogi1', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0xc0, 0x20, 0x10, 0x10, 0x08, 0x04, 0x02, 0x01, 0x0f, 0x90, 0x10, 0x20, 0xf0, 0xf8, 0xf8, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x20, 0x10, 0x10, 0x08, 0x08, 0x08, 0x08, 
        0x48, 0x47, 0x88, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x88, 0xc7, 0xc4, 0x62, 0x23, 0x10, 0x3f, 
        0x80, 0x40, 0x20, 0x10, 0x88, 0xcc, 0x43, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0xc0, 
        0x80, 0x80, 0xc0, 0xe1, 0xbe, 0x98, 0x88, 0x0c, 0x04, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x06, 0x04, 0x04, 0x04, 0x04, 
        0x05, 0x04, 0x04, 0x04, 0x07, 0x07, 0x04, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        },
        {
        // 'rtogi2', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0xc0, 0x20, 0x10, 0x10, 0x08, 0x04, 0x02, 0x01, 0x1f, 0xa0, 0x20, 0x40, 0x80, 0x00, 0xf0, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x20, 0x10, 0x10, 0x08, 0x08, 0x08, 0x08, 
        0x48, 0x47, 0x88, 0x00, 0x00, 0x00, 0x00, 0x24, 0x24, 0x28, 0x6b, 0x40, 0xa0, 0x99, 0x86, 0xff, 
        0x0f, 0x11, 0x22, 0x44, 0x48, 0x4c, 0x43, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0xc0, 
        0x80, 0x80, 0xc0, 0xe1, 0xbe, 0x98, 0x88, 0x0c, 0x04, 0x06, 0x06, 0x06, 0x0a, 0x0a, 0x06, 0x01, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x06, 0x04, 0x04, 0x04, 0x04, 
        0x05, 0x04, 0x04, 0x04, 0x07, 0x04, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        }
    };
    
    static const char PROGMEM mati[FRAMES][FRAME_SIZE] =
    {
        {        
        // 'mati2', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x08, 0x10, 0x60, 0x80, 
        0x00, 0x80, 0x60, 0x10, 0x08, 0x30, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x80, 0x40, 0x40, 0x5c, 0x00, 0x01, 
        0x41, 0x01, 0x00, 0x5c, 0x40, 0x40, 0x80, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x40, 0x80, 0xe1, 0x12, 0x0a, 0x06, 0x00, 
        0x80, 0x00, 0x06, 0x0a, 0x12, 0xe1, 0x80, 0x40, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x1f, 0x14, 0x14, 0x10, 0x10, 0x11, 0x1f, 0x10, 0x10, 0x18, 
        0x0f, 0x18, 0x10, 0x10, 0x1f, 0x11, 0x10, 0x10, 0x14, 0x14, 0x1f, 0x14, 0x14, 0x14, 0x14, 0x08, 
        },
        {
        // 'mati3', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x08, 0x10, 0x60, 0x80, 
        0x00, 0x80, 0x60, 0x10, 0x08, 0x30, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x90, 0x12, 0x0a, 0x02, 0xf4, 0x09, 
        0x0d, 0xf1, 0x04, 0x02, 0x0a, 0x12, 0x90, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x40, 0x80, 0xe1, 0x12, 0x0a, 0x06, 0x01, 
        0x81, 0x00, 0x06, 0x0a, 0x12, 0xe1, 0x80, 0x40, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x1f, 0x14, 0x14, 0x10, 0x10, 0x11, 0x1f, 0x10, 0x10, 0x18, 
        0x0f, 0x18, 0x10, 0x10, 0x1f, 0x11, 0x10, 0x10, 0x14, 0x14, 0x1f, 0x14, 0x14, 0x14, 0x14, 0x08, 
        }
    };

    static const char PROGMEM special[2][FRAME_SIZE] =
    {
        {
        // 'awake', 32x32px
        0x00, 0x40, 0x40, 0x80, 0x80, 0x04, 0x08, 0x10, 0x20, 0x00, 0xc0, 0x30, 0x08, 0x10, 0x60, 0x80, 
        0x00, 0x80, 0x60, 0x10, 0x08, 0x30, 0xc0, 0x00, 0x10, 0x08, 0x04, 0x80, 0x80, 0x40, 0x40, 0x00, 
        0x08, 0x08, 0x08, 0x08, 0x00, 0x01, 0x01, 0x00, 0x00, 0x7f, 0x80, 0x40, 0x40, 0x5c, 0x00, 0x01, 
        0x41, 0x01, 0x00, 0x5c, 0x40, 0x40, 0x80, 0x7f, 0x00, 0x01, 0x01, 0x08, 0x08, 0x08, 0x08, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x40, 0x80, 0xe1, 0x12, 0x0a, 0x06, 0x00, 
        0x80, 0x00, 0x06, 0x0a, 0x12, 0xe1, 0x90, 0x48, 0x64, 0x92, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x1f, 0x14, 0x14, 0x10, 0x10, 0x11, 0x1f, 0x10, 0x10, 0x18, 
        0x0f, 0x18, 0x10, 0x10, 0x1f, 0x11, 0x10, 0x10, 0x14, 0x14, 0x1f, 0x18, 0x00, 0x00, 0x00, 0x00
        },
        {
        // 'mati1', 32x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x08, 0x10, 0x60, 0x80, 
        0x00, 0x80, 0x60, 0x10, 0x08, 0x30, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x80, 0x40, 0x48, 0x48, 0x00, 0x01, 
        0x41, 0x01, 0x00, 0x48, 0x48, 0x40, 0x80, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x40, 0x80, 0xe1, 0x12, 0x0a, 0x06, 0x00, 
        0x80, 0x00, 0x06, 0x0a, 0x12, 0xe1, 0x90, 0x48, 0x64, 0x92, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x1f, 0x14, 0x14, 0x10, 0x10, 0x11, 0x1f, 0x10, 0x10, 0x18, 
        0x0f, 0x18, 0x10, 0x10, 0x1f, 0x11, 0x10, 0x10, 0x14, 0x14, 0x1f, 0x18, 0x00, 0x00, 0x00, 0x00
        }            
    };

    void draw_animation(void) 
    {
        // Awake animation shows a maximum of 2 seconds and switch to normal
        if (current_animation == ANIMATION_AWAKE && timer_elapsed32(keyevent_timer) > 2000)
        {
            target_animation = ANIMATION_NORMAL;
        }
        
        // First animation afther sleep will always be awake
        if (current_animation != target_animation)
        {
            if (current_animation == ANIMATION_SLEEP)
            {
                target_animation = ANIMATION_AWAKE;
            }
            
            current_animation = target_animation;
        }
        
        // Animation switch eventually to sleep
        if (current_animation !=  ANIMATION_SLEEP && timer_elapsed32(keyevent_timer) > 3000)
        {
            if (timer_elapsed32(keyevent_timer) > 21000)
            {
                if (current_animation != ANIMATION_SLEEP)
                {
                    current_frame = 0;
                }
                current_animation = ANIMATION_SLEEP;
            }
            else if (timer_elapsed32(keyevent_timer) > 18000)
            {
                if (current_animation != ANIMATION_KAKI)
                {
                    current_frame = 0;
                }
                current_animation = ANIMATION_KAKI;
            }
            else if (timer_elapsed32(keyevent_timer) > 15000)
            {
                if (current_animation != ANIMATION_MATI)
                {
                    current_frame = 0;
                }
                current_animation = ANIMATION_MATI;
            }
            else
            {
                if (current_animation != ANIMATION_NORMAL)
                {
                    current_frame = 0;
                }
                current_animation = ANIMATION_NORMAL;
            }
            
            target_animation = current_animation;
        }

        // Update the frame durations
        if (current_animation == ANIMATION_NORMAL)
        {
            frame_duration = 800;
        }
        else
        {
            frame_duration = 400;
        }
        
        // Draw the animation 
        uint8_t frameIndex = 0;
        switch (current_animation)
        {
            case ANIMATION_NORMAL:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                
                if (frameIndex == 0)
                {
                    oled_write_raw_P(special[1], sizeof(special[1]));
                }
                else 
                {
                    oled_write_raw_P(mati[0], sizeof(mati[0]));
                }
                break;

            case ANIMATION_AWAKE:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                
                if (frameIndex == 0)
                {
                    oled_write_raw_P(special[0], sizeof(special[0]));
                }
                else 
                {
                    oled_write_raw_P(mati[0], sizeof(mati[0]));
                }
                break;

            case ANIMATION_MATI:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                oled_write_raw_P(mati[frameIndex], sizeof(mati[frameIndex]));
                break;

            case ANIMATION_KAKI:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                oled_write_raw_P(kaki[frameIndex], sizeof(kaki[frameIndex]));
                break;
                
            case ANIMATION_LEFT:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                oled_write_raw_P(left[frameIndex], sizeof(left[frameIndex]));
                break;

            case ANIMATION_RIGHT:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                oled_write_raw_P(right[frameIndex], sizeof(right[frameIndex]));
                break;
                
            case ANIMATION_UP:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                oled_write_raw_P(up[frameIndex], sizeof(up[frameIndex]));
                break;
                
            case ANIMATION_DOWN:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                oled_write_raw_P(down[frameIndex], sizeof(down[frameIndex]));
                break;

            case ANIMATION_LTOGIL:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                oled_write_raw_P(ltogil[frameIndex], sizeof(ltogil[frameIndex]));
                break;

            case ANIMATION_RTOGIL:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                oled_write_raw_P(rtogil[frameIndex], sizeof(rtogil[frameIndex]));
                break;
                
            default:
                current_frame = (current_frame + 1) % FRAMES;
                frameIndex = abs((FRAMES - 1) - current_frame);
                oled_write_raw_P(sleep[frameIndex], sizeof(sleep[frameIndex]));
                break;
        }
    }

    if (timer_elapsed32(keyevent_timer) > OLED_TIMEOUT)     
    {
        oled_off();
    }
    else
    {
        if(animation_timer == 0)
        {
            animation_timer = timer_read32();
            draw_animation();
        }        
        else if(timer_elapsed32(animation_timer) > frame_duration) 
        {
            animation_timer = timer_read32();
            draw_animation();
        }
    }    
}

// Update OLED graphics
__attribute__((weak)) void oled_task_user(void) 
{
    render_logo();
    oled_set_cursor(0, 6);

    if (IS_LAYER_ON(LAYER_SUPER))
    {
        oled_write_P(PSTR("Gao!\n\n"), false);
    }
    else
    {
        if (encoder_mode == ENCODER_CODE)
        {
            oled_write_P(PSTR("Purr\n\n"), false);
        }
        else
        {
            oled_write_P(PSTR("Meow\n\n"), false);
        }
    }

    render_animation();

    oled_set_cursor(0, 12);
    
    if (IS_LAYER_ON(LAYER_MOUSE))
    {
        oled_write_P(PSTR("Mouse\n\n"), false);
    }
    else
    {
        oled_write_P(PSTR("\n\n"), false);
    }
}

#endif